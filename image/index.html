<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Generating Image...</title>
  <style>
    body {
      margin: 0;
      background: #000;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      color: white;
      font-family: sans-serif;
    }
  </style>
</head>
<body>
  <div id="status">Generating image...</div>
  <script src="https://js.puter.com/v2/"></script>
  <script>
    async function waitForPuter(retries = 20) {
      while ((!window.puter || !puter.ai || !puter.ai.txt2img) && retries > 0) {
        await new Promise(r => setTimeout(r, 250));
        retries--;
      }
      if (!puter?.ai?.txt2img) throw new Error("puter.ai.txt2img not available");
    }

    async function generateImage() {
      const params = new URLSearchParams(window.location.search);
      const prompt = params.get("prompt");
      if (!prompt) {
        document.getElementById("status").innerText = "Missing ?prompt= in URL";
        return;
      }

      try {
        await waitForPuter();
        const imgEl = await puter.ai.txt2img(prompt);
        document.body.innerHTML = ""; // Clear the page
        document.body.appendChild(imgEl);
      } catch (err) {
        document.getElementById("status").innerText = "Error: " + err.message;
      }
    }

    generateImage();
  </script>
</body>
</html>
