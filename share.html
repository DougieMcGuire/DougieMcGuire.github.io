<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Screen AI Helper</title>
<style>
  body { font-family: sans-serif; text-align: center; margin: 2rem; }
  #aiResponse { margin-top: 1rem; font-weight: bold; white-space: pre-wrap; }
</style>
</head>
<body>
<h1>Screen AI Helper</h1>
<button id="startBtn">Start Screen Share & AI</button>
<p id="status"></p>
<p id="aiResponse">AI response will appear here...</p>
<canvas id="screenshotCanvas" style="display:none;"></canvas>

<script>
const startBtn = document.getElementById('startBtn');
const status = document.getElementById('status');
const aiResponse = document.getElementById('aiResponse');
const canvas = document.getElementById('screenshotCanvas');
const ctx = canvas.getContext('2d');

const API_KEY = 'G7mssh3Pay81qZfJ'; // Your Pollinations Kontekst API key

let stream;
let track;
let captureInterval;

async function captureAndSend() {
    try {
        const imageCapture = new ImageCapture(track);
        const bitmap = await imageCapture.grabFrame();

        canvas.width = bitmap.width;
        canvas.height = bitmap.height;
        ctx.drawImage(bitmap, 0, 0);

        const dataUrl = canvas.toDataURL('image/png');

        const response = await fetch('https://api.pollinations.ai/kontext', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + API_KEY
            },
            body: JSON.stringify({
                prompt: "Describe what is happening in this screenshot.",
                image: dataUrl
            })
        });

        const result = await response.json();
        aiResponse.textContent = "AI says:\n" + result.answer;

    } catch (err) {
        console.error(err);
        status.textContent = "Error capturing screen or contacting AI: " + err.message;
    }
}

startBtn.addEventListener('click', async () => {
    try {
        status.textContent = "Requesting screen share permission...";
        stream = await navigator.mediaDevices.getDisplayMedia({ video: true });
        track = stream.getVideoTracks()[0];

        status.textContent = "Screen sharing started! Capturing every 3 seconds...";
        startBtn.disabled = true;

        captureInterval = setInterval(captureAndSend, 3000);

        // Stop sharing when tab closes or page unloads
        window.addEventListener('beforeunload', () => {
            clearInterval(captureInterval);
            track.stop();
        });

    } catch (err) {
        console.error(err);
        status.textContent = "Screen share permission denied or error: " + err.message;
    }
});
</script>
</body>
</html>
