<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Video Script Generator</title>
</head>
<body>
    <h1>Generate a Video Script</h1>

    <label>Topic:</label>
    <input type="text" id="topic" placeholder="Enter a topic"><br>

    <label>2D or 3D:</label>
    <select id="dimension">
        <option value="2D">2D</option>
        <option value="3D">3D</option>
    </select><br>

    <label>Style:</label>
    <select id="style">
        <option value="Documentary">Documentary</option>
        <option value="Story">Story</option>
        <option value="Explaining">Explaining</option>
        <option value="Custom">Custom (Type Below)</option>
    </select><br>
    <input type="text" id="customStyle" placeholder="Custom Style (if selected)"><br>

    <label>Shortform or Longform:</label>
    <select id="format">
        <option value="Shortform">Shortform</option>
        <option value="Longform">Longform</option>
    </select><br>

    <label>Additional Details:</label>
    <input type="text" id="details" placeholder="Any extra details"><br>

    <label>Voice for TTS:</label>
    <input type="text" id="voice" placeholder="Enter a voice (e.g., en-US-AriaNeural)"><br>

    <button onclick="generateScript()">Generate</button>

    <h2>Generated Script:</h2>
    <pre id="scriptOutput"></pre>

    <h2>Generated MP3:</h2>
    <audio id="audioPlayer" controls></audio>

    <h2>Generated SRT:</h2>
    <pre id="srtOutput"></pre>

    <script>
        async function generateScript() {
            const topic = document.getElementById("topic").value;
            const dimension = document.getElementById("dimension").value;
            let style = document.getElementById("style").value;
            const customStyle = document.getElementById("customStyle").value;
            const format = document.getElementById("format").value;
            const details = document.getElementById("details").value;
            const voice = document.getElementById("voice").value;

            if (style === "Custom" && customStyle.trim() !== "") {
                style = customStyle;
            }

            // Step 1: Generate script using Groq API
            const groqResponse = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": "Bearer YOUR_GROQ_API_KEY"
                },
                body: JSON.stringify({
                    "model": "llama-3.3-70b-versatile",
                    "messages": [{
                        "role": "user",
                        "content": `Generate me the most perfect YouTube ${format} video script about ${topic}. When I say video script, I mean just what the narrator should say. Do not send any extra text, do not converse with me. Whatever you send will be sent directly to a TTS model. ONLY put what the narrator should say, as if this will be read off every word you send. Be descriptive. Make this perfect for attention and engagement. It should be in this style: ${style}. ${details ? details : ""}`
                    }]
                })
            });

            const groqData = await groqResponse.json();
            const scriptText = groqData.choices?.[0]?.message?.content || "Error generating script.";

            document.getElementById("scriptOutput").textContent = scriptText;

            // Step 2: Send script to TTS API
            const ttsResponse = await fetch("https://o-6sxb.onrender.com/generate-speech", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    "text": scriptText,
                    "voice": voice || "en-US-AriaNeural"
                })
            });

            const ttsData = await ttsResponse.json();
            const audioUrl = ttsData.audio_url;

            if (audioUrl) {
                document.getElementById("audioPlayer").src = audioUrl;

                // Step 3: Get SRT file from STT API
                const formData = new FormData();
                formData.append("file", await fetch(audioUrl).then(res => res.blob()), "audio.mp3");

                const sttResponse = await fetch("https://stt-ym3y.onrender.com/convert", {
                    method: "POST",
                    body: formData
                });

                const srtData = await sttResponse.json();
                const srtText = srtData.srt || "Error generating subtitles.";

                document.getElementById("srtOutput").textContent = srtText;
            } else {
                document.getElementById("audioPlayer").textContent = "Error generating audio.";
            }
        }
    </script>
</body>
</html>
