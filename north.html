<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Video Script Generator</title>
</head>
<body>
    <h1>Generate a Video Script</h1>

    <label>Topic:</label>
    <input type="text" id="topic"><br><br>

    <label>Format:</label>
    <select id="format">
        <option value="2D">2D</option>
        <option value="3D">3D</option>
    </select><br><br>

    <label>Style:</label>
    <select id="style">
        <option value="Documentary">Documentary (Well-studied, professional)</option>
        <option value="Story">Story (Narrative-driven)</option>
        <option value="Explaining">Explaining (How things work)</option>
        <option value="Custom">Custom (Enter below)</option>
    </select>
    <input type="text" id="customStyle" placeholder="Custom Style (if selected)"><br><br>

    <label>Length:</label>
    <select id="length">
        <option value="shortform">Shortform</option>
        <option value="longform">Longform</option>
    </select><br><br>

    <label>Additional Notes:</label>
    <textarea id="notes"></textarea><br><br>

    <label>Voice:</label>
    <input type="text" id="voice" placeholder="e.g., en-US-AriaNeural"><br><br>

    <button onclick="generateScript()">Generate Script</button>

    <h2>Output</h2>
    <p><strong>Script:</strong></p>
    <pre id="scriptOutput"></pre>

    <p><strong>Audio:</strong></p>
    <audio id="audioPlayer" controls></audio>

    <p><strong>Subtitles (SRT):</strong></p>
    <pre id="srtOutput"></pre>

    <script>
        async function generateScript() {
            const topic = document.getElementById("topic").value;
            const format = document.getElementById("format").value;
            const style = document.getElementById("style").value === "Custom" ? 
                document.getElementById("customStyle").value : document.getElementById("style").value;
            const length = document.getElementById("length").value;
            const notes = document.getElementById("notes").value;
            const voice = document.getElementById("voice").value || "en-US-AriaNeural";

            if (!topic) {
                alert("Please enter a topic.");
                return;
            }

            const prompt = `Generate me the most perfect YouTube (${length}) video script about (${topic}). 
            When I say video script, I mean just what the narrator should say. 
            Do not send me any extra text, do not converse with me. Whatever you send will be sent directly to a TTS model. 
            ONLY put what the narrator should say, as if this will be read off every word you send. 
            Be descriptive. Make this perfect for attention and engagement. 
            It should be in this style: (${style}) ${notes ? "Additional notes: " + notes : ""}`;

            try {
                // Step 1: Generate script with Groq API
                const response = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": "Bearer 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"
                    },
                    body: JSON.stringify({
                        model: "llama-3.3-70b-versatile",
                        messages: [{ role: "user", content: prompt }]
                    })
                });

                const data = await response.json();
                if (!data.choices || !data.choices.length) throw new Error("No script generated.");
                const script = data.choices[0].message.content.trim();
                document.getElementById("scriptOutput").innerText = script;

                // Step 2: Convert script to audio (TTS API)
                const ttsResponse = await fetch("https://o-6sxb.onrender.com/generate-speech", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ text: script, voice: voice })
                });

                const ttsData = await ttsResponse.json();
                if (!ttsData.audio_url) throw new Error("TTS failed.");
                document.getElementById("audioPlayer").src = ttsData.audio_url;

                // Step 3: Generate subtitles (STT API)
                const sttFormData = new FormData();
                sttFormData.append("file", await fetch(ttsData.audio_url).then(res => res.blob()));

                const sttResponse = await fetch("https://stt-ym3y.onrender.com/convert", {
                    method: "POST",
                    body: sttFormData
                });

                const sttData = await sttResponse.json();
                if (!sttData.srt) throw new Error("STT failed.");
                document.getElementById("srtOutput").innerText = sttData.srt;

            } catch (error) {
                alert("Error: " + error.message);
            }
        }
    </script>
</body>
</html>
