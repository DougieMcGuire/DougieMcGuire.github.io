<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1v1 Game</title>
    <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-database.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyB4Sa8mLb2lLpmrrMM9bX_loiTS3MYul14",
            authDomain: "toydemo-341bc.firebaseapp.com",
            databaseURL: "https://toydemo-341bc-default-rtdb.firebaseio.com",
            projectId: "toydemo-341bc",
            storageBucket: "toydemo-341bc.firebasestorage.app",
            messagingSenderId: "843712244489",
            appId: "1:843712244489:web:8474efba9732edda7fc1d8",
            measurementId: "G-QQRZQR4HZK"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let playerId = null;
        let players = {};

        document.addEventListener("DOMContentLoaded", () => {
            const startMenu = document.getElementById("start-menu");
            const gameContainer = document.getElementById("game-container");
            const nameInput = document.getElementById("name-input");
            const startButton = document.getElementById("start-button");

            startButton.addEventListener("click", () => {
                const playerName = nameInput.value.trim();
                if (playerName) {
                    playerId = Date.now().toString();
                    db.ref("players/" + playerId).set({
                        name: playerName,
                        x: Math.random() * 800,
                        y: 300
                    });

                    startMenu.style.display = "none";
                    gameContainer.style.display = "block";
                    initGame();
                }
            });
        });

        function initGame() {
            const canvas = document.getElementById("gameCanvas");
            const ctx = canvas.getContext("2d");

            document.addEventListener("keydown", (event) => {
                if (!playerId || !players[playerId]) return;
                let player = players[playerId];

                if (event.key === "ArrowLeft") player.x -= 5;
                if (event.key === "ArrowRight") player.x += 5;
                if (event.key === "ArrowUp") player.y -= 5;
                if (event.key === "ArrowDown") player.y += 5;

                db.ref("players/" + playerId).set(player);
            });

            db.ref("players").on("value", (snapshot) => {
                players = snapshot.val() || {};
                renderGame(ctx);
            });

            window.addEventListener("beforeunload", () => {
                db.ref("players/" + playerId).remove();
            });
        }

        function renderGame(ctx) {
            ctx.clearRect(0, 0, 800, 400);
            ctx.fillStyle = "green";
            ctx.fillRect(0, 350, 800, 50); // Baseplate

            for (let id in players) {
                let player = players[id];
                ctx.fillStyle = id === playerId ? "blue" : "red";
                ctx.fillRect(player.x, player.y, 20, 40); // Body
                ctx.fillRect(player.x + 5, player.y - 10, 10, 10); // Head
            }
        }
    </script>
</head>
<body>
    <div id="start-menu">
        <input type="text" id="name-input" placeholder="Enter your name">
        <button id="start-button">Start</button>
    </div>
    <div id="game-container" style="display: none;">
        <canvas id="gameCanvas" width="800" height="400"></canvas>
    </div>
</body>
</html>
