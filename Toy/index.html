<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FPS Demo</title>
    <style>
        body, html { margin: 0; padding: 0; overflow: hidden; }
        canvas { display: block; }
    </style>
</head>
<body>
    <script type="module">
        import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.136/build/three.module.js';
        import { PointerLockControls } from 'https://cdn.jsdelivr.net/npm/three@0.136/examples/jsm/controls/PointerLockControls.js';
        import { Player } from './character.js';

        let scene, camera, renderer, controls, player;

        function init() {
            // Scene setup
            scene = new THREE.Scene();

            // Camera setup
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 1.6, 5);

            // Renderer setup
            renderer = new THREE.WebGLRenderer();
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // Lighting
            const light = new THREE.AmbientLight(0xffffff);
            scene.add(light);

            // Floor
            const floorGeometry = new THREE.PlaneGeometry(50, 50);
            const floorMaterial = new THREE.MeshStandardMaterial({ color: 0x444444 });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            scene.add(floor);

            // Player Character
            player = new Player(scene);

            // First-person controls
            controls = new PointerLockControls(camera, document.body);
            document.addEventListener('click', () => controls.lock());

            const keys = {};
            document.addEventListener('keydown', (e) => keys[e.key] = true);
            document.addEventListener('keyup', (e) => keys[e.key] = false);

            function animate() {
                requestAnimationFrame(animate);

                // Basic movement
                let speed = 0.1;
                if (keys["w"]) player.updatePosition(player.body.position.x, player.body.position.y, player.body.position.z - speed);
                if (keys["s"]) player.updatePosition(player.body.position.x, player.body.position.y, player.body.position.z + speed);
                if (keys["a"]) player.updatePosition(player.body.position.x - speed, player.body.position.y, player.body.position.z);
                if (keys["d"]) player.updatePosition(player.body.position.x + speed, player.body.position.y, player.body.position.z);

                renderer.render(scene, camera);
            }

            animate();
        }

        init();
    </script>
</body>
</html>
