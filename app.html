<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Reactor</title>
</head>
<body>
    <input type="text" id="youtubeUrl" placeholder="Enter YouTube Video URL">
    <button onclick="getTranscript()">Generate Reactions</button>
    <pre id="output"></pre>
    <script>
        async function getTranscript() {
            const urlInput = document.getElementById('youtubeUrl').value;
            const output = document.getElementById('output');
            output.textContent = 'Loading...';

            if (!urlInput) {
                output.textContent = 'Please enter a YouTube URL';
                return;
            }

            try {
                const videoId = urlInput.split('v=')[1]?.split('&')[0];
                if (!videoId) throw new Error('Invalid YouTube URL');

                const transcriptRes = await fetch('https://free-api-call.aiseo.ai/youtube-video-transcript', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url: urlInput })
                });
                const transcriptData = await transcriptRes.json();
                if (!transcriptData?.transcript) throw new Error('Failed to fetch transcript');

                const transcript = transcriptData.transcript;
                const chunks = transcript.reduce((acc, item, i) => {
                    if (i % 2 === 0 || i === transcript.length - 1) {
                        const text = `${acc.current.join(' ')} ${item.text}`;
                        acc.result.push({ text, timestamp: Math.round(parseFloat(transcript[i].start)) });
                        acc.current = [];
                    } else {
                        acc.current.push(item.text);
                    }
                    return acc;
                }, { current: [], result: [] }).result.filter((_, i) => (i + 1) % 3 !== 0);

                const reactions = await Promise.all(chunks.map(async chunk => {
                    const prompt = `You are a reaction YouTuber. React with excitement and emotion to this part of a video: "${chunk.text}" (Timestamp: s${chunk.timestamp}). Your response should be engaging and relatable.`;
                    const response = await fetch('https://api-inference.huggingface.co/models/facebook/blenderbot-400M-distill', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': 'Bearer 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'
                        },
                        body: JSON.stringify({ inputs: prompt })
                    });
                    const responseData = await response.json();
                    return `Reaction for Timestamp s${chunk.timestamp}: ${responseData.generated_text || 'No reaction available'}`;
                }));

                output.textContent = reactions.join('\n');
            } catch (err) {
                output.textContent = 'Error: ' + err.message;
            }
        }
    </script>
</body>
</html>
